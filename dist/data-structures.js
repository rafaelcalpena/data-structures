!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.dataStructures=e():t.dataStructures=e()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=13)}([function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),a=function(){function t(t){this.internal=t}return t.fromEmpty=function(){return new t({state:u.fromObject({})})},t.fromArray=function(e){var n=e.map(function(t){return[t,!0]});return new t({state:u.fromPairs(n)})},t.prototype.add=function(e){if(this.internal.state.has(e))throw new Error("Could not add '"+e+"' to StringSet: Item already exists");return new t({state:this.internal.state.add(e,!0)})},t.prototype.merge=function(e){return this.internal.state.has(e)?this:new t({state:this.internal.state.add(e,!0)})},t.prototype.isEmpty=function(){return this.internal.state.isEmpty()},t.prototype.size=function(){return this.internal.state.size()},t.prototype.has=function(t){return this.internal.state.has(t)},t.prototype.remove=function(e){if(!this.internal.state.has(e))throw new Error("Could not remove from StringSet: item '"+e+"' does not exist");return new t({state:this.internal.state.remove(e)})},t.prototype.removeMany=function(e){return new t({state:this.internal.state.removeMany(e)})},t.prototype.intersection=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.internal.state).keysIntersection.apply(t,o(e.map(function(t){return t.asPointerMap()})))},t.prototype.filter=function(e){return new t({state:this.internal.state.filter(e)})},t.prototype.forEach=function(t){this.internal.state.forEach(t)},t.prototype.toObject=function(){return this.internal.state.toObject()},t.prototype.union=function(){for(var e,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new t({state:(e=this.internal.state).keysUnion.apply(e,o(n))})},t.prototype.first=function(){return this.internal.state.firstKey()},t.prototype.toArray=function(){return this.internal.state.keysArray()},t.prototype.asPointerMap=function(){return this.internal.state},t}();e.StringSet=a;var u=function(){function t(t){this.internal=t}return t.fromObject=function(e){return new t({props:{size:Object.keys(e).length},state:e})},t.keyInEvery=function(t,e){return e.reduce(function(e,n){return!1!==e&&n.has(t)},!0)},t.fromPairs=function(e){var n=0,r=e.reduce(function(t,e){if(n+=1,e[0]in t)throw new Error("Could not create PointerMap: Pairs contain duplicate key '"+e[0]+"'");return t[e[0]]=e[1],t},{});return new t({props:{size:n},state:r})},t.prototype.size=function(){return this.internal.props.size},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.has=function(t,e){var n=this.internal.state;return t in n&&(!e||n[t]===e)},t.prototype.add=function(e,n){var i;if(this.has(e))throw new Error("Could not add to PointerMap: key '"+e+"' already exists");return new t({props:{size:this.internal.props.size+1},state:r({},this.internal.state,(i={},i[e]=void 0===n||n,i))})},t.prototype.keysUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(function(t,e){var n=t;return e.forEach(function(t,e){n.has(t)||(n=n.add(t,e))}),n},this)},t.prototype.set=function(e,n){var i,o=this.has(e);return new t({props:{size:this.internal.props.size+(o?0:1)},state:r({},this.internal.state,(i={},i[e]=n,i))})},t.prototype.setMany=function(e){var n=this,i=r({},this.internal.state),o=this.internal.props.size;return s.forEach(e,function(t,e){var r=n.has(e);o+=r?0:1,i[e]=t}),new t({props:{size:o},state:i})},t.prototype.remove=function(t){return this.removeMany([t])},t.prototype.removeMany=function(e){var n=this,r=Object.assign({},this.internal.state);return e.forEach(function(t){if(!n.has(t))throw new Error("Could not remove from PointerMap: key '"+t+"' does not exist");delete r[t]}),new t({props:{size:this.internal.props.size-e.length},state:r})},t.prototype.get=function(t){if(!this.has(t))throw new Error("Could not get from PointerMap: key '"+t+"' does not exist");return this.internal.state[t]},t.prototype.toObject=function(){return r({},this.internal.state)},t.prototype.keysIntersection=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(e=o([this],e)).reduce(function(t,e){return e.size()<t.size?{item:e,size:e.size()}:t},{item:null,size:1/0}).item.reduce(function(n,r,i){return t.keyInEvery(i,e)?n.add(i):n},a.fromEmpty())},t.prototype.filter=function(e,n){var r=this,i=t.fromObject({});return this.forEach(function(t){!0===e(t)&&(i=i.add(t,!!n||r.internal.state[t]))}),i},t.prototype.forEach=function(t){var e=this;Object.keys(this.internal.state).forEach(function(n){return t(n,e.internal.state[n])})},t.prototype.firstKey=function(){var t,e=this.internal.state;return s.forEach(e,function(e,n){return t=n,!1}),t},t.prototype.toPairs=function(){var t=this.internal,e=t.state;t.items;return Object.keys(e).map(function(t){return[t,e[t]]})},t.prototype.keysArray=function(){var t=this.internal,e=t.state;t.items;return Object.keys(e)},t.prototype.keysSet=function(){return a.fromArray(this.keysArray())},t.prototype.reduce=function(t,e){var n=this.internal.state;return Object.keys(n).reduce(function(e,r){return t(e,n[r],r)},e)},t}();e.PointerMap=u},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),a=n(12),u=n(11),f=n(10);e.SSetStaticMethods=function(t){return{fromArray:function(e,n){var i=this;JSON.parse(JSON.stringify(e));var o={plugins:t,props:n||{size:e.length},state:e.reduce(function(t,e){var n;return r({},t,((n={})[i.hashOf(e)]=e,n))},{})},s=Object.keys(t),u=a.initializePlugins(o,s);return new h(u)},hashOf:function(t){return f(t,{respectType:!1,algorithm:"sha1"})},fromJSON:function(e){var n=JSON.parse(e);return h.addPlugins(t).fromArray(n.state,n.props)},addPlugins:function(n){return e.SSetStaticMethods(r({},t,n))},removePlugins:function(n){var i=s.omit(r({},t),n);return e.SSetStaticMethods(i)},filterPlugins:function(n){return e.SSetStaticMethods(r({},t)).removePlugins(s.difference(Object.keys(t),n))},getActivePlugins:function(){return Object.keys(t)}}};var h=function(){function t(t){var e=this;this.statePropsPlugins=t,this.getActivePlugins=function(){return Object.keys(e.statePropsPlugins.plugins)}}return t.prototype.add=function(e){var n=t.hashOf(e);if(e=u.updatePlugins("onBeforeAdd",[e],[n],this.statePropsPlugins).value,t.hashOf(e)in this.statePropsPlugins.state)throw new Error("Value "+e+" is already contained in the set");return this.merge(e)},t.prototype.merge=function(e,n){if(e instanceof t)throw new Error("Please use union for merging two sets");var r=t.hashOf(e);return this.mergeHash(r,e)},t.prototype.mergeHash=function(e,n){var i,o=!(e in this.statePropsPlugins.state);n=u.updatePlugins("onBeforeAdd",[n],[e],this.statePropsPlugins).value;var s={plugins:this.statePropsPlugins.plugins,props:r({},this.statePropsPlugins.props,{size:t.hashOf(n)in this.statePropsPlugins.state?this.statePropsPlugins.props.size:this.statePropsPlugins.props.size+1}),state:r({},this.statePropsPlugins.state,(i={},i[e]=n,i))};return o&&(s=u.updatePlugins("onAdd",[n],[e],s)),new t(s)},t.prototype.mergeArray=function(t){return t.reduce(function(t,e){return t.merge(e)},this)},t.prototype.remove=function(e){var n=t.hashOf(e);if(!(n in this.statePropsPlugins.state))throw new Error("There is no value "+e+" in the set.");var i={plugins:this.statePropsPlugins.plugins,props:r({},this.statePropsPlugins.props,{size:this.statePropsPlugins.props.size-1}),state:s.omit(this.statePropsPlugins.state,[n])};return new t(i=u.updatePlugins("onRemove",[e],[n],i))},t.prototype.removeHash=function(t){return this.removeHashes([t])},t.prototype.removeHashes=function(e){var n=this;if(0===e.length)return this;e.forEach(function(t){if(!(t in n.statePropsPlugins.state))throw new Error("Could not remove hash from SSet: hash '"+t+"' does not exist in the set")});var i=s.omit(this.statePropsPlugins.state,e);if(e.length>=.5*this.size()){var o=s.reduce(i,function(t,e){return t.push(e),t},[]);return t.addPlugins(this.statePropsPlugins.plugins).fromArray(o)}var a={plugins:this.statePropsPlugins.plugins,props:r({},this.statePropsPlugins.props,{size:this.statePropsPlugins.props.size-e.length}),state:i};return new t(a=u.updatePlugins("onRemove",e.map(function(t){return n.statePropsPlugins.state[t]}),e,a))},t.prototype.union=function(t){return this.internalTwoSetsOperations(["union"],this,t).union},t.prototype.difference=function(t){var e=this.internalTwoSetsOperations(["difference"],this,t).difference;return e.probEquals(this)?this:e},t.prototype.symmetricDifference=function(t){var e=this.internalTwoSetsOperations(["union","intersection"],this,t),n=e.union,r=e.intersection;return this.internalTwoSetsOperations(["difference"],n,r).difference},t.prototype.intersection=function(t){return this.internalTwoSetsOperations(["intersection"],this,t).intersection},t.prototype.map=function(e){var n=t.fromArray([]);return this.forEach(function(t){return n=n.add(e(t))}),n},t.prototype.filter=function(t){var e=this,n=[];return this.forEach(function(e,r){t(e,r)||n.push(r)}),e=e.removeHashes(n)},t.prototype.size=function(){return this.statePropsPlugins.props.size},t.prototype.$=function(t,e){void 0===e&&(e=[]);var n=this.statePropsPlugins,r=n.state,i=n.props;return n.plugins[t].API(r,i[t],this,e)},t.prototype.addPlugins=function(e){var n=this.statePropsPlugins.plugins,i=t.fromArray(Object.keys(n)),o=Object.keys(e),s=t.fromArray(o);if(!i.isDisjoint(s)){var u=s.intersection(i),f=u.size()>1?"s":"",h=u.size()>1?"are":"is";throw new Error("Could not add plugin"+f+" to SSet: Plugin"+f+" '"+u.toArray().join(", ")+"' "+h+" already active")}return this.statePropsPlugins=r({},this.statePropsPlugins,{plugins:r({},this.statePropsPlugins.plugins,e)}),new t(a.initializePlugins(this.statePropsPlugins,o))},t.prototype.removePlugins=function(e){var n=this,i=e.reduce(function(t,e){if(!(e in n.statePropsPlugins.plugins))throw new Error("Could not remove plugin from SSet: Plugin '"+e+"' does not exist in this SSet");return n.statePropsPlugins.plugins[e].onDestroy(),s.omit(t,[e])},r({},this.statePropsPlugins.plugins));return new t(r({},this.statePropsPlugins,{plugins:i}))},t.prototype.filterPlugins=function(t){return this.removePlugins(s.difference(this.getActivePlugins(),t))},t.prototype.isSubset=function(t){return this.difference(t).isEmpty()},t.prototype.isSuperset=function(t){return t.difference(this).isEmpty()},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.hasSet=function(t){return this.isSuperset(t)},t.prototype.inSet=function(t){return this.isSubset(t)},t.prototype.has=function(e){return t.hashOf(e)in this.statePropsPlugins.state},t.prototype.getOne=function(){var t=this;return this.getSortedKeysArray().map(function(e){return t.statePropsPlugins.state[e]})[0]},t.prototype[Symbol.iterator]=function(){return{items:this.toArray(),next:function(){return{done:0===this.items.length,value:this.items.shift()}}}},t.prototype.forEach=function(t){var e=this,n=this.getSortedKeysArray();n.forEach(function(r,i){t(e.statePropsPlugins.state[r],r,i+1===n.length)})},t.prototype.every=function(t){var e=!0;return this.forEach(function(n){!0!==t(n)&&(e=!1)}),e},t.prototype.some=function(t){var e=!1;return this.forEach(function(n){!0===t(n)&&(e=!0)}),e},t.prototype.find=function(t){var e;return this.forEach(function(n){!0===t(n)&&(e=n)}),e},t.prototype.reduce=function(t,e){return this.forEach(function(n){e=t(e,n)}),e},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},t.prototype.changesTo=function(t){return{changes:{difference:this.difference(t),union:t.difference(this)},from:this,to:t}},t.prototype.changesFrom=function(t){return t.changesTo(this)},t.prototype.applyChanges=function(t){return this.union(t.union).difference(t.difference)},t.prototype.revertChanges=function(t){return this.union(t.difference).difference(t.union)},t.prototype.equals=function(t){return this===t||this.symmetricDifference(t).isEmpty()},t.prototype.probEquals=function(t){return this===t},t.prototype.toJSON=function(){return{props:r({},this.statePropsPlugins.props),state:this.toArray()}},t.prototype.isDisjoint=function(t){return this.intersection(t).isEmpty()},t.prototype.getByHash=function(t){var e=this.statePropsPlugins.state;if(t in e)return e[t];throw new Error("No item in the set corresponds to hash '"+t+"'")},t.prototype.hasHash=function(t){return t in this.statePropsPlugins.state},t.prototype.internalTwoSetsOperations=function(t,e,n){var r=i(function(t,e){return t.size()<e.size()?[t,e]:[e,t]}(e,n),2),s=r[0],a=r[1],u=function(t,e,n,r){var i=[{set:n,hashes:[]},function(t,e,n,r,i){return n&&t.hashes.push(r),!0===i?{set:t.set.removeHashes(t.hashes)}:t}],o=[{set:r,hashes:[]},function(t,e,n,r,i){return n&&t.hashes.push(r),!0===i?{set:t.set.removeHashes(t.hashes)}:t}];return{difference:t===n?i:o,intersection:[{set:r},function(t,e,n,r){return{set:n?t.set:t.set.removeHash(r)}}],oppositeDifference:t===n?o:i,union:[{set:n},function(t,e,n,r){return{set:t.set.mergeHash(r,e)}}]}}(e,0,a,s),f=t.map(function(t){return o([t],u[t])});return s.forEach(function(t,e,n){var r=a.hasHash(e);f.forEach(function(i){i[1]=i[2](i[1],t,r,e,n)})}),f.reduce(function(t,e){return t[e[0]]=e[1].set,t},{})},t.prototype.getSortedKeysArray=function(){return Object.keys(this.statePropsPlugins.state).sort()},t.fromArray=e.SSetStaticMethods({}).fromArray,t.hashOf=e.SSetStaticMethods({}).hashOf,t.fromJSON=e.SSetStaticMethods({}).fromJSON,t.addPlugins=e.SSetStaticMethods({}).addPlugins,t.removePlugins=e.SSetStaticMethods({}).removePlugins,t.getActivePlugins=e.SSetStaticMethods({}).getActivePlugins,t.filterPlugins=e.SSetStaticMethods({}).filterPlugins,t}();e.SSet=h},function(t,e){t.exports=require("lodash")},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(0),s=function(t,e){var n=t.state,r=t.props.size;return function(t,i){if(void 0===t)return{state:n,props:{size:r}};n.has(t)||(n=n.add(t,o.StringSet.fromEmpty()));var s,a=n.get(t);if(a.has(i))throw new Error(e(t,i));return s=a.add(i),n=n.set(t,s),{props:{size:r+1},state:n}}},a=function(){function t(t){this.internal=t}return t.fromPairs=function(e){var n=o.PointerMap.fromObject({}),i=e.reduce(function(t,e){return s(t,function(t,e){return"Could not create MultiMap: Pairs contain duplicate path '"+t+"' -> '"+e+"'"})(e[0],e[1])},{props:{size:0},state:n});return new t(r({},i))},t.prototype.add=function(e,n){return new t(r({},s(this.internal,function(t,e){return"Could not add to MultiMap: Path '"+t+"' -> '"+e+"' already exists"})(e,n)))},t.prototype.has=function(t,e){return this.internal.state.has(t)&&(void 0===e||this.internal.state.get(t).has(e))},t.prototype.getOne=function(t){return this.internal.state.get(t).first()},t.prototype.from=function(t){var e=this.internal.state;if(!e.has(t))throw new Error("Could not read from MultiMap: key '"+t+"' does not exist");return e.get(t)},t.prototype.remove=function(t,e){var n,r,i=this.internal;i.state,i.props.size;return void 0===e?this.removeMany(((n={})[t]=!0,n)):this.removeMany(((r={})[t]=[e],r))},t.prototype.removeMany=function(e){var n=this.internal.state,r=[],o={},s=this.size();Object.keys(e).map(function(t){return[t,e[t]]}).forEach(function(t){var e=i(t,2),a=e[0],u=e[1];if(!n.has(a))throw new Error("Could not remove from MultiMap: key '"+a+"' does not exist");if("boolean"==typeof u)s-=n.get(a).size(),r.push(a);else{var f=n.get(a);u.forEach(function(t){if(!f.has(t))throw new Error("Could not remove from MultiMap: path '"+a+"' -> '"+t+"' does not exist")}),s-=u.length;var h=f.removeMany(u);0===h.size()?r.push(a):o[a]=h}});var a=n.removeMany(r).setMany(o);return new t({props:{size:s},state:a})},t.prototype.toObject=function(){var t=this.internal.state.toObject();return Object.keys(t).reduce(function(e,n){var i;return r({},e,((i={})[n]=t[n].toObject(),i))},{})},t.prototype.size=function(){return this.internal.props.size},t}();e.MultiMap=a},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var s=n(1),a=n(2),u=n(5),f=n(8),h=n(0),d=n(7),c=function(t,e,n){var r,i=e.reduce(function(e,r){return o(e,[function(t,e){return e.index.has(t[0],t[1])?e.index.from(t[0],t[1]):h.StringSet.fromEmpty()}([t,r],n)])},[]);return i[0]?(r=i[0]).union.apply(r,o(i.splice(1))):h.StringSet.fromEmpty()};e.indexPlugin={onInit:function(t){t=a.reduce(t,function(t,e,n){var i,o;if(!a.isPlainObject(e))throw new Error("All items within a Collection must be plain objects");if(!("id"in e)){var f=r({},e,{id:u()});return a.omit(r({},t,((i={})[s.SSet.hashOf(f)]=f,i)),[n])}return r({},t,((o={})[n]=e,o))},{});var e=Object.keys(t).map(function(e){return{hash:e,item:t[e]}}).reduce(d.createTriples,[]);return{props:{index:f.DefaultIndex.fromTriples(e),inverse:f.DefaultIndex.fromTriples(e.map(function(t){return[t[2],t[0],t[1]]}))},state:t}},onRemove:function(t,e,n,r){var i={index:[],inverse:[]};return t.forEach(function(t,r){var o=e[r];a.forEach(t,function(t,e){var r=n.inverse.get(o,e),s=[e,r,o],a=[o,e,r];i.index.push(s),i.inverse.push(a)})}),{index:n.index.removeMany(i.index),inverse:n.inverse.removeMany(i.inverse)}},onBeforeAdd:function(t,e,n,i){var o;return t.forEach(function(t){o=t.id?{continue:!0,message:null,value:t}:{continue:!0,message:null,value:r({},t,{id:u()})}}),o},onAdd:function(t,e,n,r){var i=n;return t.forEach(function(t,n){var r=e[n];i=a.reduce(t,function(t,e,n){var i=s.SSet.hashOf(e);return{index:t.index.add(n,i,r),inverse:t.inverse.add(r,n,i)}},i)}),i},API:function(t,e,n,r){var u=i(r,1)[0];return{findOne:function(n){var r,i,u=a.reduce(n,function(t,n,r){var i=[r,s.SSet.hashOf(n)];return o(t,[e.index.has(i[0],i[1])?e.index.from(i[0],i[1]):h.StringSet.fromEmpty()])},[]);return i=u.length>1?(r=u[0]).intersection.apply(r,o(u.slice(1))).first():u[0].first(),t[i]},findOneHashOrigin:function(t){var n,r=a.reduce(t,function(t,n,r){var i=[r,n];return o(t,[e.index.has(i[0],i[1])?e.index.from(i[0],i[1]):h.StringSet.fromEmpty()])},[]);return r.length>1?(n=r[0]).intersection.apply(n,o(r.slice(1))).first():r[0].first()},findOneHash:function(n){var r,i,s=a.reduce(n,function(t,n,r){var i=[r,n];return o(t,[e.index.has(i[0],i[1])?e.index.from(i[0],i[1]):h.StringSet.fromEmpty()])},[]);return i=s.length>1?(r=s[0]).intersection.apply(r,o(s.slice(1))).first():s[0].first(),t[i]},find:function(t){var n,r,i=a.reduce(t,function(t,n,r){var i=[r,s.SSet.hashOf(n)];return o(t,[e.index.has(i[0],i[1])?e.index.from(i[0],i[1]):h.StringSet.fromEmpty()])},[]);return r=i.length>1?(n=i[0]).intersection.apply(n,o(i.slice(1))):i[0],u.filterHashes(r)},findHash:function(t){var n,r,i=a.reduce(t,function(t,n,r){if(a.isArray(n))return o(t,[c(r,n,e)]);var i=[r,n];return o(t,[e.index.has(i[0],i[1])?e.index.from(i[0],i[1]):h.StringSet.fromEmpty()])},[]);return r=i.length>1?(n=i[0]).intersection.apply(n,o(i.slice(1))):i[0],u.filterHashes(r)},getIndex:function(){return e.index},getMetadata:function(){return e.inverse}}}};var p=function(){function t(t){this.internal=t}return t.fromArray=function(n){return new t({set:s.SSet.addPlugins({indexPlugin:e.indexPlugin}).fromArray(n)})},t.prototype.filterHashes=function(t){return this.filter(function(e,n){return t.has(n)})},t.prototype.findOne=function(t){return this.internal.set.$("indexPlugin",[this]).findOne(t)},t.prototype.findOneHash=function(t){return this.internal.set.$("indexPlugin",[this]).findOneHash(t)},t.prototype.findOneHashOrigin=function(t){return this.internal.set.$("indexPlugin",[this]).findOneHashOrigin(t)},t.prototype.find=function(t){return this.internal.set.$("indexPlugin",[this]).find(t)},t.prototype.findHash=function(t){return this.internal.set.$("indexPlugin",[this]).findHash(t)},t.prototype.add=function(e){var n=this.internal.set.add(e);return new t(r({},this.internal,{set:n}))},t.prototype.merge=function(e){var n=this.internal.set.merge(e);return new t(r({},this.internal,{set:n}))},t.prototype.union=function(e){var n=e.internal.set,i=this.internal.set.union(n);return new t(r({},this.internal,{set:i}))},t.prototype.difference=function(e){var n=e.internal.set,r=this.internal.set.difference(n);return r===this.internal.set?this:new t({set:r})},t.prototype.has=function(t){return this.internal.set.has(t)},t.prototype.isEmpty=function(){return 0===this.size()},t.prototype.remove=function(e){var n=this.internal.set.remove(e);return new t(r({},this.internal,{set:n}))},t.prototype.removeHash=function(t){return this.removeHashes([t])},t.prototype.removeHashes=function(e){var n=this.internal.set.removeHashes(e);return new t(r({},this.internal,{set:n}))},t.prototype.getOne=function(){return this.internal.set.getOne()},t.prototype[Symbol.iterator]=function(){return this.internal.set[Symbol.iterator]()},t.prototype.map=function(e){return new t(r({},this.internal,{set:this.internal.set.map(e)}))},t.prototype.forEach=function(t){var e=this;this.internal.set.forEach(function(n,r){var i=e.getMetadata().get(r);t(n,r,i)})},t.prototype.filter=function(e){var n=this;return new t(r({},this.internal,{set:this.internal.set.filter(function(t,r){var i=n.getMetadata().get(r);return e(t,r,i)})}))},t.prototype.size=function(){return this.internal.set.size()},t.prototype.toArray=function(){return this.internal.set.toArray()},t.prototype.getByHash=function(t){return this.internal.set.getByHash(t)},t.prototype.getByIdHash=function(t){return this.internal.set.getByHash(this.internal.set.$("indexPlugin").getIndex().get("id",t))},t.prototype.getIndex=function(){return this.internal.set.$("indexPlugin").getIndex()},t.prototype.getMetadata=function(){return this.internal.set.$("indexPlugin").getMetadata()},t.prototype.changesFrom=function(t){return t.changesTo(this)},t.prototype.changesTo=function(e){var n=t.fromArray([]),r=e,i=[];return this.forEach(function(t,e,o){var s=t.id,a=r.findOneHash({id:o.getOne("id")}),u=r.findOneHashOrigin({id:o.getOne("id")});a?(u!==e&&(n=n.add({after:a,before:t,id:s,type:"edit"})),i.push(u)):n=n.add({id:s,item:t,type:"remove"})}),(r=r.removeHashes(i)).forEach(function(t){var e=t.id;n=n.add({id:e,item:t,type:"add"})}),n},t}();e.Collection=p},function(t,e){t.exports=require("uuid/v4")},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=n(4),a=n(1),u=function(){function t(e){var n,r,u=this;this.internal=e,this.nodes=((n={add:function(e){var n=u.internal,r=n.nodes,i=n.edges;if(u.nodes.hasId(e.id))throw new Error("Could not add Node to Graph: Node already exists");return new t({edges:i,nodes:r.add(e)})}.bind(this),findOne:function(t){var e=u.internal,n=e.nodes;e.edges;return n.findOne(t)}.bind(this),remove:function(e){var n=u.internal,r=n.nodes,i=n.edges;if(!r.has(e))throw new Error("Could not remove Node from Graph: Node does not exist");return new t({edges:i,nodes:r.remove(e)})}.bind(this),union:function(e){var n=u.internal,r=n.nodes;return new t({edges:n.edges,nodes:r.union(e.nodes.getAll())})}.bind(this),getAll:function(){return u.internal.nodes}.bind(this),getByHash:function(t){return u.internal.nodes.getByHash(t)}.bind(this),getByIdHash:function(t){return u.internal.nodes.getByIdHash(t)}.bind(this),update:function(e,n){var r=u.internal,i=r.nodes,o=r.edges;if(!i.has(e))throw new Error("Could not update Node from Graph: Node does not exist");return new t({edges:o,nodes:i.remove(e).add(n)})}.bind(this),updateId:function(e,n){var r=u.internal,i=r.nodes,o=r.edges,s=i.findOne({id:e});if(!s)throw new Error("Could not update Node from Graph: Node does not exist");return a.SSet.hashOf(s)===a.SSet.hashOf(n)?u:new t({edges:o,nodes:i.remove(s).add(n)})}.bind(this),has:function(t){return u.internal.nodes.has(t)}.bind(this),getId:function(t){var e=u.internal,n=e.nodes,r=(e.edges,n.findOne({id:t}));if(o.isUndefined(r))throw new Error("Could not get Node: Node Id '"+t+"' does not exist in Graph");return r}.bind(this),hasId:function(t){var e=u.internal,n=e.nodes;e.edges;return void 0!==t&&void 0!==n.findOne({id:t})}.bind(this),oneReachedById:function(t){var e=u.edges.fromId(t);if(!e.edges.isEmpty()){var n=e.edges.getAll().getOne();return u.nodes.getId(n.to)}}.bind(this),reachedById:function(e){var n=u.edges.fromId(e).internal.edges.map(function(t){return u.nodes.getId(t.to)});return new t({edges:s.Collection.fromArray([]),nodes:n})}.bind(this),find:function(e){var n=u.internal,r=n.nodes;n.edges;return new t({edges:s.Collection.fromArray([]),nodes:r.find(e)})}.bind(this),filter:function(e){var n=u.internal,r=n.nodes;n.edges;return new t({edges:s.Collection.fromArray([]),nodes:r.filter(e)})}.bind(this),forEach:function(t){var e=u.internal,n=e.nodes;e.edges;n.forEach(t)}.bind(this),isEmpty:function(){return u.internal.nodes.isEmpty()}.bind(this),getStartingNodes:function(){return u.nodes.filter(function(t,e,n){var r=n.getOne("id");return void 0===u.edges.findOneHash({to:r})})}.bind(this),removeEdgesFromNodes:function(t,e){var n=t.nodes.difference(e),r=[];return e.nodes.getAll().forEach(function(t,e,n){r.push(n.getOne("id"))}),n=n.edges.findAndDifferenceHash({from:r})}.bind(this),topologicalSort:function(){var t=function(e,n){if(void 0===n&&(n=[]),e.nodes.isEmpty())return n;var r=e.nodes.getStartingNodes(),o=u.nodes.removeEdgesFromNodes(e,r);return t(o,i(n,[r]))};return t(u)}.bind(this),difference:function(e){var n=u.internal,r=n.nodes,i=n.edges,o=r.difference(e.nodes.getAll());return o===r?u:new t({edges:i,nodes:o})}.bind(this),size:function(){return u.internal.nodes.size()}.bind(this)})[Symbol.iterator]=function(){return u.internal.nodes[Symbol.iterator]()}.bind(this),n),this.edges=((r={union:function(e){var n=u.internal,r=n.nodes;return new t({edges:n.edges.union(e.edges.getAll()),nodes:r})}.bind(this),difference:function(e){var n=u.internal,r=n.nodes,i=n.edges,o=i.difference(e.edges.getAll());return o===i?u:new t({edges:o,nodes:r})}.bind(this),map:function(e){var n=u.internal,r=n.nodes;return new t({edges:n.edges.map(e),nodes:r})}.bind(this),filter:function(e){var n=u.internal;n.nodes;return new t({edges:n.edges.filter(e),nodes:s.Collection.fromArray([])})}.bind(this),find:function(e){var n=u.internal;n.nodes;return new t({edges:n.edges.find(e),nodes:s.Collection.fromArray([])})}.bind(this),findHash:function(e){var n=u.internal;n.nodes;return new t({edges:n.edges.findHash(e),nodes:s.Collection.fromArray([])})}.bind(this),findAndDifference:function(t){return u.edges.difference(u.edges.find(t))}.bind(this),findAndDifferenceHash:function(t){var e=u.edges.findHash(t);return u.edges.difference(e)}.bind(this),forEach:function(t){var e=u.internal;e.nodes;e.edges.forEach(t)}.bind(this),getAll:function(){return u.internal.edges}.bind(this),getByHash:function(t){return u.internal.edges.getByHash(t)}.bind(this),getByIdHash:function(t){return u.internal.edges.getByIdHash(t)}.bind(this),toggle:function(t){var e=u.internal;e.nodes,e.edges;return u.edges.hasId(t.id)?u.edges.remove(t):u.edges.add(t)}.bind(this),remove:function(e){var n=u.internal,r=n.nodes,i=n.edges;if(!i.has(e))throw new Error("Could not remove Edge from Graph: Edge does not exist");return new t({edges:i.remove(e),nodes:r})}.bind(this),add:function(e){var n=u.internal,r=n.nodes,i=n.edges;if(u.edges.hasId(e.id))throw new Error("Could not add Edge to Graph: Edge Id already exists");return new t({edges:i.add(e),nodes:r})}.bind(this),update:function(e,n){var r=u.internal,i=r.nodes,o=r.edges;if(!o.has(e))throw new Error("Could not update Edge from Graph: Edge does not exist");return new t({edges:o.remove(e).add(n),nodes:i})}.bind(this),updateId:function(e,n){var r=u.internal,i=r.nodes,o=r.edges,s=o.findOne({id:e});if(!s)throw new Error("Could not update Edge from Graph: Edge does not exist");return a.SSet.hashOf(s)===a.SSet.hashOf(n)?u:new t({edges:o.remove(s).add(n),nodes:i})}.bind(this),hasId:function(t){var e=u.internal,n=(e.nodes,e.edges);return void 0!==t&&void 0!==n.findOne({id:t})}.bind(this),fromId:function(e){var n=u.internal;n.nodes;return new t({edges:n.edges.find({from:e}),nodes:s.Collection.fromArray([])})}.bind(this)})[Symbol.iterator]=function(){return u.internal.edges[Symbol.iterator]()}.bind(this),r.findOne=function(t){var e=u.internal;e.nodes;return e.edges.findOne(t)}.bind(this),r.findOneHash=function(t){var e=u.internal;e.nodes;return e.edges.findOneHash(t)}.bind(this),r.size=function(){return u.internal.edges.size()}.bind(this),r.isEmpty=function(){return u.internal.edges.isEmpty()}.bind(this),r.getId=function(t){var e=u.internal.edges.findOne({id:t});if(o.isUndefined(e))throw new Error("Could not get Edge: Edge Id '"+t+"' does not exist in Graph");return e}.bind(this),r),this.getSignature=function(){return"@labshare/data-structures/graph"}}return t.fromObject=function(e){var n=e.nodes,r=e.edges,i=s.Collection.fromArray(n);return new t({edges:s.Collection.fromArray(r),nodes:i})},t.fromEmpty=function(){return t.fromObject({edges:[],nodes:[]})},t.prototype.toObject=function(){var t=this.internal,e=t.nodes;return{edges:t.edges.toArray(),nodes:e.toArray()}},t.prototype.union=function(t){return this.edges.union(t).nodes.union(t)},t.prototype.changesFrom=function(t){var e=this.internal,n=e.nodes;return{edges:e.edges.changesFrom(t.edges.getAll()),nodes:n.changesFrom(t.nodes.getAll())}},t.prototype.changesTo=function(t){return t.changesFrom(this)},t}();e.Graph=u},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(r(arguments[e]));return t};Object.defineProperty(e,"__esModule",{value:!0});var o=n(1);e.createTriples=function(t,e){var n=e.hash,r=e.item;return Object.keys(r).forEach(function(e){var s=o.SSet.hashOf(r[e]);t=i(t,[[e,s,n]])}),t}},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},i=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=n(0),a=function(){function t(t){this.internal=t}return t.fromTriples=function(e){var n=s.PointerMap.fromObject({});return new t(n=e.reduce(function(t,e){t.has(e[0])||(t=t.add(e[0],o.MultiMap.fromPairs([[]])));var n=t.get(e[0]);if(n.has(e[1],e[2]))throw new Error("Could not add to DefaultIndex: path '"+e.join(", ")+"' already exists");var r=n.add(e[1],e[2]);return t.set(e[0],r)},n))},t.prototype.toObject=function(){return this.internal.reduce(function(t,e,n){var i;return r({},t,((i={})[n]=e.toObject(),i))},{})},t.prototype.has=function(t,e,n){return this.internal.has(t)&&(void 0===e||this.internal.get(t).has(e,n))},t.prototype.get=function(t,e){return void 0!==e?this.internal.get(t).getOne(e):this.internal.get(t)},t.prototype.from=function(t,e){if(this.internal.has(t)){var n=this.internal.get(t);if(void 0!==e){if(n.has(e))return n.from(e);throw new Error("Could not read from DefaultIndex: path '"+t+" -> "+e+"' does not exist")}return n}throw new Error("Could not read from DefaultIndex: key '"+t+"' does not exist")},t.prototype.add=function(e,n,r){var i=this.internal;i.has(e)||(i=i.add(e,o.MultiMap.fromPairs([[]])));var s=i.get(e);if(s.has(n,r))throw new Error("Could not add to DefaultIndex: path '"+[e,n,r].join(", ")+"' already exists");var a=s.add(n,r);return new t(i.set(e,a))},t.prototype.remove=function(t,e,n){return this.removeMany([[t,e,n]])},t.prototype.orderTriples=function(t){var e={};return t.forEach(function(t){e[t[0]]=e[t[0]]||{},e[t[0]][t[1]]=e[t[0]][t[1]]||[],e[t[0]][t[1]].push(t[2])}),e},t.prototype.removeMany=function(e){var n=this.orderTriples(e),r=this.internal,o=Object.keys(n),s=[],a={},u=function(t,e,n){return"Could not remove from DefaultIndex: path '"+[t,e,n].join(", ")+"' does not exist"};e.forEach(function(t){var e=i(t,3),n=e[0],o=e[1],s=e[2];if(!r.has(n))throw new Error(u(n,o,s));if(!r.get(n).has(o,s))throw new Error(u(n,o,s))});return o.map(function(t){return[t,n[t]]}).forEach(function(t){var e=i(t,2),n=e[0],o=e[1],u=r.get(n);0===(u=u.removeMany(o)).size()?s.push(n):a[n]=u}),new t(r=r.removeMany(s).setMany(a))},t}();e.DefaultIndex=a},function(t,e,n){"use strict";var r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s};Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=n(0),s=n(1),a=function(t,e){var n=r(e,2),i=n[0],o=n[1],a=s.SSet.hashOf(i),u=s.SSet.hashOf(o);if(t.hashMap.has(a))throw new Error('2 pairs have the same keys: "'+i+'"');return t.hashMap=t.hashMap.add(a,u),t.inverseMap=t.inverseMap.add(u,a),t.items=t.items.merge(i),t.items=t.items.merge(o),t},u=function(){function t(t){this.internalState=t}return t.fromPairs=function(e){var n=o.PointerMap.fromObject({}),r=i.MultiMap.fromPairs([[]]),u=s.SSet.fromArray([]);return new t(e.reduce(a,{hashMap:n,inverseMap:r,items:u}))},t.prototype.get=function(t){var e=this.internalState,n=e.hashMap,r=e.items,i=s.SSet.hashOf(t);if(!this.hasHash(i))throw new Error("Could not get from SMap: key '"+t+"' does not exist");return r.getByHash(n.get(i))},t.prototype.has=function(t){var e=s.SSet.hashOf(t);return this.hasHash(e)},t.prototype.hasHash=function(t){return this.internalState.hashMap.has(t)},t.prototype.remove=function(e){var n=this.internalState,r=n.items,i=n.inverseMap,o=n.hashMap,a=s.SSet.hashOf(e);if(!o.has(a))throw new Error("Could not remove from SMap: key '"+e+"' does not exist");var u,f,h,d=o.get(a);u=r,f=o.remove(a),h=i.remove(d,a);var c=u.getByHash(a);if(function(t,e){return!e.has(t)}(a,h)&&u.has(c)&&(u=u.remove(c)),u.hasHash(d)){var p=u.getByHash(d);(function(t,e,n){return!(e.has(t)||n.has(t))})(d,f,h)&&u.has(p)&&(u=u.remove(p))}return new t({hashMap:f,inverseMap:h,items:u})},t.prototype.add=function(t,e){var n=this.internalState,r=n.hashMap;n.items;if(r.has(s.SSet.hashOf(t)))throw new Error("Could not add to SMap: key '"+t+"' already exists");return this.set(t,e)},t.prototype.toPairs=function(){var t=this.internalState,e=t.hashMap,n=t.items;return e.toPairs().map(function(t){var e=r(t,2),i=e[0],o=e[1];return[n.getByHash(i),n.getByHash(o)]})},t.prototype.set=function(e,n){var r,i,o,a,u=this.internalState,f=u.hashMap,h=u.items,d=u.inverseMap,c=s.SSet.hashOf(e),p=s.SSet.hashOf(n);return f.has(c)&&p===(a=f.get(c))?this:(i=h.merge(n).merge(e),r=f.set(c,p),o=d.add(p,c),o=a?o.remove(a,c):o,!a||r.has(a)||o.has(a)||(i=i.remove(h.getByHash(a))),new t({hashMap:r,inverseMap:o,items:i}))},t}();e.SMap=u},function(t,e){t.exports=require("object-hash")},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};Object.defineProperty(e,"__esModule",{value:!0}),e.updatePlugins=function(t,e,n,i){var o=i.plugins,s=i.state,a=i.props;if("onBeforeAdd"===t){var u={continue:!0,message:null,value:e};return 0===Object.keys(o).length&&1===e.length?{continue:!0,message:null,value:e[0]}:Object.keys(o).reduce(function(r,i){var u=o[i][t];u||(u=function(){return{continue:!0,message:null,value:e}});var f=u(e,n,a[i],s);if(!0!==f.continue)throw new Error("Plugin "+i+" did not allow insertion: "+f.message);return f},u)}return Object.keys(o).reduce(function(i,u){var f,h=(0,o[u][t])(e,n,a[u],s);return{plugins:o,props:r({},i.props,(f={},f[u]=h,f)),state:s}},i)}},function(t,e,n){"use strict";var r=this&&this.__assign||Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t};Object.defineProperty(e,"__esModule",{value:!0}),e.initializePlugins=function(t,e){var n=t.plugins,i=t.state,o=t.props,s=e.reduce(function(t,e){var s,a=n[e].onInit(i,o[e]),u=a.props,f=a.state;return{props:r({},t.props,(s={},s[e]=u,s)),state:f}},{props:r({},o),state:r({},i)});return r({},t,s)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(5);e.UUID=r;var i=n(1);e.SSet=i.SSet;var o=n(9);e.SMap=o.SMap;var s=n(0);e.PointerMap=s.PointerMap;var a=n(3);e.MultiMap=a.MultiMap;var u=n(4);e.Collection=u.Collection;var f=n(6);e.Graph=f.Graph}])});